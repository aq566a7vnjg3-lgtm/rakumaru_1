<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>メンテナンス維持費 簡易計算シート（1画面表示）</title>
  <style>
    :root{
      --bg:#0aa64f;
      --line:#d9d9d9;
      --muted:#666;
      --card:#fff;
    }
    *{box-sizing:border-box;}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial, sans-serif;
      margin:0; background:#fafafa;
      -webkit-text-size-adjust: 100%;
    }
    header{background:var(--bg); color:#fff; padding:12px 14px;}
    header h1{margin:0; font-size:16px; font-weight:800; letter-spacing:.2px;}
    main{padding:12px 12px 18px; max-width:1100px; margin:0 auto;}
    .controls{
      display:flex; flex-wrap:wrap; gap:10px 12px; align-items:flex-end;
      margin-bottom:10px;
    }
    label{display:flex; flex-direction:column; gap:6px; font-size:12px; color:#111;}
    select, input[type="number"]{
      padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff; font-size:14px;
      min-width: 150px;
    }
    .note{font-size:12px; color:var(--muted); margin:6px 0 10px; line-height:1.35;}
    .sheet{
      background:var(--card); border:1px solid var(--line); border-radius:14px;
      overflow:hidden;
      box-shadow:0 2px 10px rgba(0,0,0,.04);
    }
    table{border-collapse:separate; border-spacing:0; width:100%; font-size:13px;}
    thead th{
      background:#f3f7f5; border-bottom:1px solid var(--line);
      padding:10px 8px; text-align:center; white-space:nowrap;
    }
    th, td{border-bottom:1px solid var(--line); padding:8px 8px;}
    tbody tr:hover td{background:#fcfffd;}
    td.num{text-align:right; white-space:nowrap;}
    td.center{text-align:center;}
    .col-name{width:38%;}
    .col-unit{width:20%;}
    .col-count{width:18%;}
    .col-amt{width:24%;}
    .input-mini{width:100%; max-width:150px;}
    .input-count{width:100%; max-width:120px;}
    .yen{font-variant-numeric: tabular-nums;}
    .section-row td{background:#f8faf9; font-weight:800;}
    .total-row td{background:#f3f7f5; font-weight:900;}
    .badge{
      display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px;
      background:rgba(255,255,255,.18); border:1px solid rgba(255,255,255,.25);
      margin-left:8px;
    }
    .hidden{display:none;}
    .footer-actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:center;}
    button{
      border:1px solid var(--line); background:#fff; padding:10px 12px; border-radius:12px; cursor:pointer;
      font-size:13px;
    }
    button.primary{background:var(--bg); color:#fff; border-color:transparent;}
    button:active{transform: translateY(1px);}
    .small{font-size:12px; color:var(--muted);}
    /* iPad 横画面を想定して、1画面に収まるように少し詰める */
    @media (max-width: 1024px){
      header h1{font-size:15px;}
      table{font-size:12.5px;}
      th, td{padding:7px 7px;}
      select, input[type="number"]{font-size:14px; padding:8px 10px;}
      .controls{gap:9px 10px;}
    }
    @media (max-width: 820px){
      table{font-size:12px;}
      th, td{padding:6px 6px;}
      select, input[type="number"]{min-width: 140px;}
    }
  </style>
</head>
<body>
<header>
  <h1>メンテナンス維持費 簡易計算シート（1画面表示）<span class="badge">工賃込み / 税込み</span></h1>
</header>

<main>
  <div class="controls">
    <label>
      車両区分
      <select id="vehicleType">
        <option value="kei">軽自動車</option>
        <option value="small">小型車</option>
        <option value="normal">普通車</option>
        <option value="ev">EV車（N-ONEe）</option>
      </select>
    </label>

    <label>
      期間（表示する列）
      <select id="periodSel">
        <option value="2_5">2年半</option>
        <option value="4_5">4年半</option>
        <option value="6_5">6年半</option>
        <option value="10">10年</option>
      </select>
    </label>

    <label id="taxClassWrap" class="hidden">
      普通車 税区分（任意）
      <select id="taxClass">
        <option value="1500">自動車税 1500CC</option>
        <option value="2000">自動車税 2000CC</option>
      </select>
    </label>

    <div class="small">
      ・単価/回数は編集できます（初期値＝基準値）<br/>
      ・金額は <b>単価 × 回数</b> で自動計算します
    </div>
  </div>

  <div class="sheet">
    <table id="tbl">
      <thead>
        <tr>
          <th class="col-name">メンテナンス（固定）</th>
          <th class="col-unit">単価</th>
          <th class="col-count"><span id="periodLabelHead">2年半</span> 回数</th>
          <th class="col-amt"><span id="periodLabelHead2">2年半</span> 金額</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>

      <tbody>
        <tr class="total-row">
          <td>合計（メンテナンス）</td>
          <td></td>
          <td></td>
          <td class="num yen" id="sum_main">-</td>
        </tr>
      </tbody>

      <tbody id="extraSection">
        <tr class="section-row">
          <td>自動車税 / 自賠責保険（自動切替）</td>
          <td colspan="3" class="small">※ 車両区分により表示/非表示が切り替わります</td>
        </tr>
      </tbody>

      <tbody>
        <tr class="total-row">
          <td>合計（メンテナンス + 表示中の税/保険）</td>
          <td></td>
          <td></td>
          <td class="num yen" id="sum_grand">-</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="footer-actions">
    <button class="primary" id="resetBtn">この車両区分の基準値に戻す</button>
    <button id="copyJsonBtn">現在値をJSONでコピー</button>
    <div class="small" id="copyStatus"></div>
  </div>
</main>

<script>
/** 期間キー */
const PERIODS = [
  { key: "2_5", label: "2年半" },
  { key: "4_5", label: "4年半" },
  { key: "6_5", label: "6年半" },
  { key: "10",  label: "10年" },
];

const fmtJPY = new Intl.NumberFormat("ja-JP", { style:"currency", currency:"JPY", maximumFractionDigits:0 });

/** 元データ（基準値） */
const BASE = {
  normal: {
    label: "普通車",
    items: [
      { name:"安全点検", unit:10450, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"12ヶ月点検", unit:18700, counts:{ "2_5":2,"4_5":3,"6_5":4,"10":6 } },
      { name:"車検（基本料金＋代行費用含む）", unit:53350, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"エンジンオイル交換", unit:6743, counts:{ "2_5":5,"4_5":9,"6_5":13,"10":20 } },
      { name:"エンジンオイルエレメント交換", unit:2530, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーンフィルター交換", unit:7260, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーナーエレメント交換", unit:3080, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":5 } },
      { name:"フロントブレーキパッド交換", unit:21120, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"リアブレーキパッド/シュー交換", unit:21230, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"ブレーキフルード交換", unit:2739, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"トランスミッションオイル交換", unit:10340, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"エンジンプラグ交換", unit:17050, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"A/Cベルト交換", unit:13585, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ACGベルト交換", unit:13585, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"バッテリー交換", unit:32340, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":4 } },
      { name:"ワイパーゴム交換", unit:3520, counts:{ "2_5":1,"4_5":4,"6_5":6,"10":10 } },
      { name:"パンク修理剤交換", unit:6490, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ノーマルタイヤ4本交換", unit:99000, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":3 } },
    ],
    extras: {
      tax_1500: { name:"自動車税1500CC", unit:30500, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":10 } },
      tax_2000: { name:"自動車税2000CC", unit:34500, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":10 } },
      jibaiseki:{ name:"自賠責保険", unit:18160, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":3 } },
    }
  },
  small: {
    label: "小型車",
    items: [
      { name:"安全点検", unit:9350, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"12ヶ月点検", unit:16500, counts:{ "2_5":2,"4_5":3,"6_5":4,"10":6 } },
      { name:"車検（基本料金＋代行費用含む）", unit:50050, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"エンジンオイル交換", unit:6226, counts:{ "2_5":5,"4_5":9,"6_5":13,"10":20 } },
      { name:"エンジンオイルエレメント交換", unit:2530, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーンフィルター交換", unit:5610, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーナーエレメント交換", unit:3080, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":5 } },
      { name:"フロントブレーキパッド交換", unit:18810, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"リアブレーキパッド/シュー交換", unit:19250, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"ブレーキフルード交換", unit:2739, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"トランスミッションオイル交換", unit:6600, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"エンジンプラグ交換", unit:16280, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"A/Cベルト交換", unit:9020, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ACGベルト交換", unit:9020, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"バッテリー交換", unit:29590, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":4 } },
      { name:"ワイパーゴム交換", unit:3520, counts:{ "2_5":1,"4_5":4,"6_5":6,"10":10 } },
      { name:"パンク修理剤交換", unit:5500, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ノーマルタイヤ4本交換", unit:80300, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":3 } },
    ],
    extras: {
      tax_1500: { name:"自動車税1500CC", unit:30500, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":10 } },
      jibaiseki:{ name:"自賠責保険", unit:18160, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":3 } },
    }
  },
  kei: {
    label: "軽自動車",
    items: [
      { name:"安全点検", unit:8800, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"12ヶ月点検", unit:15400, counts:{ "2_5":2,"4_5":3,"6_5":4,"10":6 } },
      { name:"車検（基本料金＋代行費用含む）", unit:47850, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"エンジンオイル交換", unit:5379, counts:{ "2_5":5,"4_5":9,"6_5":13,"10":20 } },
      { name:"エンジンオイルエレメント交換", unit:2530, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーンフィルター交換", unit:5610, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーナーエレメント交換", unit:1980, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":5 } },
      { name:"フロントブレーキパッド交換", unit:16390, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"リアブレーキパッド/シュー交換", unit:17270, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"ブレーキフルード交換", unit:2739, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"トランスミッションオイル交換", unit:6270, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"エンジンプラグ交換", unit:14630, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"A/Cベルト交換", unit:8800, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ACGベルト交換", unit:7700, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"バッテリー交換", unit:18480, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":4 } },
      { name:"ワイパーゴム交換", unit:3520, counts:{ "2_5":1,"4_5":4,"6_5":6,"10":10 } },
      { name:"パンク修理剤交換", unit:4730, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ノーマルタイヤ4本交換", unit:60500, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":3 } },
    ],
    extras: {
      tax_660: { name:"自動車税 660CC", unit:10800, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":10 } },
      jibaiseki:{ name:"自賠責保険", unit:18040, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":3 } },
    }
  },
  ev: {
    label: "EV車（N-ONEe）",
    items: [
      { name:"安全点検", unit:8800, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"12ヶ月点検", unit:15400, counts:{ "2_5":2,"4_5":3,"6_5":4,"10":6 } },
      { name:"車検（基本料金＋代行費用含む）", unit:47850, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"エンジンオイル交換", unit:5379, counts:{ "2_5":0,"4_5":0,"6_5":13,"10":0 } },
      { name:"エンジンオイルエレメント交換", unit:2530, counts:{ "2_5":0,"4_5":0,"6_5":6,"10":0 } },
      { name:"エアクリーンフィルター交換", unit:5610, counts:{ "2_5":2,"4_5":4,"6_5":6,"10":9 } },
      { name:"エアクリーナーエレメント交換", unit:1980, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":5 } },
      { name:"フロントブレーキパッド交換", unit:16390, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"リアブレーキパッド/シュー交換", unit:17270, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":2 } },
      { name:"ブレーキフルード交換", unit:2739, counts:{ "2_5":0,"4_5":1,"6_5":2,"10":4 } },
      { name:"トランスミッションオイル交換", unit:6270, counts:{ "2_5":0,"4_5":0,"6_5":1,"10":0 } },
      { name:"エンジンプラグ交換", unit:14630, counts:{ "2_5":0,"4_5":0,"6_5":1,"10":0 } },
      { name:"A/Cベルト交換", unit:8800, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ACGベルト交換", unit:7700, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"バッテリー交換", unit:18480, counts:{ "2_5":1,"4_5":2,"6_5":3,"10":4 } },
      { name:"ワイパーゴム交換", unit:3520, counts:{ "2_5":1,"4_5":4,"6_5":6,"10":10 } },
      { name:"パンク修理剤交換", unit:4730, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":2 } },
      { name:"ノーマルタイヤ4本交換", unit:60500, counts:{ "2_5":0,"4_5":1,"6_5":1,"10":3 } },
    ],
    extras: {} // 参考データ上は非表示
  },
};

let state = {
  vehicle: "kei",
  period: "2_5",
  rows: [],
  extras: []
};

function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }

function buildExtras(vehicleKey){
  const base = BASE[vehicleKey];
  const e = base.extras || {};
  if(vehicleKey === "normal"){
    const tax = document.getElementById("taxClass").value;
    const taxKey = (tax === "2000") ? "tax_2000" : "tax_1500";
    return [ deepClone(e[taxKey]), deepClone(e.jibaiseki) ].filter(Boolean);
  }
  if(vehicleKey === "small"){
    return [ deepClone(e.tax_1500), deepClone(e.jibaiseki) ].filter(Boolean);
  }
  if(vehicleKey === "kei"){
    return [ deepClone(e.tax_660), deepClone(e.jibaiseki) ].filter(Boolean);
  }
  return [];
}

function buildStateFromBase(vehicleKey){
  state.vehicle = vehicleKey;
  state.rows = deepClone(BASE[vehicleKey].items);
  state.extras = buildExtras(vehicleKey);
}

function createNumInput(value, cls){
  const inp = document.createElement("input");
  inp.type = "number";
  inp.value = Number(value ?? 0);
  inp.min = "0";
  inp.step = "1";
  inp.className = cls;
  return inp;
}

function calcRowAmount(row){
  const unit = Number(row.unit || 0);
  const cnt = Number(row.counts?.[state.period] || 0);
  return unit * cnt;
}

function renderPeriodLabels(){
  const label = PERIODS.find(p => p.key === state.period)?.label || "";
  document.getElementById("periodLabelHead").textContent = label;
  document.getElementById("periodLabelHead2").textContent = label;
}

function render(){
  renderPeriodLabels();

  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  state.rows.forEach((row, idx) => {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = row.name;
    tr.appendChild(tdName);

    const tdUnit = document.createElement("td");
    tdUnit.className = "center";
    const inpUnit = createNumInput(row.unit, "input-mini");
    inpUnit.addEventListener("input", () => { state.rows[idx].unit = Number(inpUnit.value || 0); recalc(); });
    tdUnit.appendChild(inpUnit);
    tr.appendChild(tdUnit);

    const tdC = document.createElement("td");
    tdC.className = "center";
    const inpC = createNumInput(row.counts[state.period] ?? 0, "input-count");
    inpC.addEventListener("input", () => { state.rows[idx].counts[state.period] = Number(inpC.value || 0); recalc(); });
    tdC.appendChild(inpC);
    tr.appendChild(tdC);

    const tdA = document.createElement("td");
    tdA.className = "num yen";
    tdA.textContent = fmtJPY.format(Math.round(calcRowAmount(row)));
    tr.appendChild(tdA);

    tbody.appendChild(tr);
  });

  renderExtras();
  recalc();
}

function renderExtras(){
  const sec = document.getElementById("extraSection");
  [...sec.querySelectorAll("tr")].slice(1).forEach(tr => tr.remove());

  state.extras = buildExtras(state.vehicle);

  const showExtras = state.extras.length > 0;
  sec.classList.toggle("hidden", !showExtras);

  const taxWrap = document.getElementById("taxClassWrap");
  taxWrap.classList.toggle("hidden", state.vehicle !== "normal");

  if(!showExtras) return;

  state.extras.forEach((row, idx) => {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = row.name;
    tr.appendChild(tdName);

    const tdUnit = document.createElement("td");
    tdUnit.className = "center";
    const inpUnit = createNumInput(row.unit, "input-mini");
    inpUnit.addEventListener("input", () => { state.extras[idx].unit = Number(inpUnit.value || 0); recalc(); });
    tdUnit.appendChild(inpUnit);
    tr.appendChild(tdUnit);

    const tdC = document.createElement("td");
    tdC.className = "center";
    const inpC = createNumInput(row.counts[state.period] ?? 0, "input-count");
    inpC.addEventListener("input", () => { state.extras[idx].counts[state.period] = Number(inpC.value || 0); recalc(); });
    tdC.appendChild(inpC);
    tr.appendChild(tdC);

    const tdA = document.createElement("td");
    tdA.className = "num yen";
    tdA.textContent = fmtJPY.format(Math.round(calcRowAmount(row)));
    tr.appendChild(tdA);

    sec.appendChild(tr);
  });
}

function recalc(){
  // 金額更新
  const tbody = document.getElementById("tbody");
  [...tbody.rows].forEach((tr, idx) => {
    tr.cells[3].textContent = fmtJPY.format(Math.round(calcRowAmount(state.rows[idx])));
  });

  const sec = document.getElementById("extraSection");
  const extraRows = [...sec.querySelectorAll("tr")].slice(1);
  extraRows.forEach((tr, idx) => {
    tr.cells[3].textContent = fmtJPY.format(Math.round(calcRowAmount(state.extras[idx])));
  });

  // 合計
  let sumMain = 0;
  let sumExtra = 0;
  state.rows.forEach(r => sumMain += calcRowAmount(r));
  state.extras.forEach(r => sumExtra += calcRowAmount(r));

  document.getElementById("sum_main").textContent = fmtJPY.format(Math.round(sumMain));
  document.getElementById("sum_grand").textContent = fmtJPY.format(Math.round(sumMain + sumExtra));
}

function resetToBase(){
  buildStateFromBase(state.vehicle);
  render();
}

function copyCurrentJson(){
  const payload = {
    vehicle: state.vehicle,
    period: state.period,
    taxClass: document.getElementById("taxClass").value,
    rows: state.rows,
    extras: state.extras
  };
  const txt = JSON.stringify(payload, null, 2);
  navigator.clipboard.writeText(txt).then(() => setCopyStatus("コピーしました（JSON）"))
    .catch(() => setCopyStatus("コピーに失敗しました。ブラウザの権限をご確認ください。"));
}

let statusTimer = null;
function setCopyStatus(msg){
  const el = document.getElementById("copyStatus");
  el.textContent = msg;
  if(statusTimer) clearTimeout(statusTimer);
  statusTimer = setTimeout(() => el.textContent = "", 2500);
}

function init(){
  buildStateFromBase("kei");
  render();

  document.getElementById("vehicleType").addEventListener("change", (e) => {
    buildStateFromBase(e.target.value);
    render();
  });

  document.getElementById("periodSel").addEventListener("change", (e) => {
    state.period = e.target.value;
    render(); // 回数入力も期間に合わせて切替
  });

  document.getElementById("taxClass").addEventListener("change", () => {
    if(state.vehicle === "normal") render();
  });

  document.getElementById("resetBtn").addEventListener("click", resetToBase);
  document.getElementById("copyJsonBtn").addEventListener("click", copyCurrentJson);
}

init();
</script>
</body>
</html>
